---
# tasks file for common
- name: Install dotfiles
  git: dest="~/dotfiles" repo="https://github.com/JPry/dotfiles.git" force=yes
  register: dotfiles_updated

- name: Echo dotfiles result
  debug:
    var: dotfiles_updated
    verbosity: 3

- name: Run dotfiles installer
  shell: install/symlinks.sh
  args:
    chdir: ~/dotfiles
    executable: /bin/bash
  when: dotfiles_updated.changed

- name: Install Gems
  become: true
  gem: name="{{ item }}" state=latest user_install=false include_doc=true
  with_items: "{{ ruby_gems }}"
  when: do_gems == true

- name: Insall Oh My Zsh
  git: dest="~/.oh-my-zsh" repo="https://github.com/robbyrussell/oh-my-zsh.git"

- name: Synchronize .ssh folder
  synchronize:
    copy_links: yes
    src: ~/.ssh
    dest: ~/

- name: Install VVV
  git:
    dest: "{{ vvv_dir }}"
    repo: https://github.com/Varying-Vagrant-Vagrants/VVV.git
    force: yes
    accept_hostkey: yes

- name: Find installed vagrant plugins
  shell: "/usr/local/bin/vagrant plugin list"
  args:
    executable: /bin/bash
  register: vagrant_plugins_existing
  changed_when: false

- name: Install Vagrant plugins
  shell: "/usr/local/bin/vagrant plugin install {{ item }}"
  with_items: "{{ vagrant_plugins }}"
  args:
    executable: /bin/bash
  when: "'{{ item }}' not in vagrant_plugins_existing.stdout"
